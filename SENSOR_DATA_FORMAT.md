# ğŸŒ¡ï¸ æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨æ•°æ®æ ¼å¼å®Œæ•´æ–‡æ¡£

## âœ… å·²å®Œæˆå®ç°

### åŠŸèƒ½æ¸…å•
- âœ… åŸºäº PID è¿‡æ»¤ä¼ æ„Ÿå™¨è®¾å¤‡
- âœ… è§£ææ¸©åº¦æ•°æ®ï¼ˆtemp â†’ é™¤ä»¥ 10ï¼‰
- âœ… è§£ææ¹¿åº¦æ•°æ®ï¼ˆhumi â†’ é™¤ä»¥ 10ï¼‰
- âœ… è§£æç”µé‡æ•°æ®ï¼ˆbetteryï¼‰
- âœ… åˆ›å»ºæ¸©åº¦ä¼ æ„Ÿå™¨å®ä½“
- âœ… åˆ›å»ºæ¹¿åº¦ä¼ æ„Ÿå™¨å®ä½“
- âœ… åˆ›å»ºç”µé‡ä¼ æ„Ÿå™¨å®ä½“
- âœ… ä½¿ç”¨ CoordinatorEntity è‡ªåŠ¨æ›´æ–°

---

## ğŸ“Š çœŸå®æ•°æ®ç¤ºä¾‹

### æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨çŠ¶æ€

```json
{
  "temp": 273,          // 27.3Â°C (é™¤ä»¥ 10)
  "humi": 467,          // 46.7%  (é™¤ä»¥ 10)
  "online": true,
  "type": 5,            // â† æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ç±»å‹
  "bettery": 99,        // 99% ç”µé‡
  "deviceName": "device0E24D2E62710"
}
```

### å¯¹åº”çš„è®¾å¤‡ä¿¡æ¯

```json
{
  "deviceId": 3734,
  "deviceName": "device0E24D2E62710",
  "deviceGroupName": "75",
  "deviceClass": "WIFIQC2",
  "deviceMoldPid": "P075",     // â† åœ¨ sensor PID åˆ—è¡¨ä¸­
  ...
}
```

### PID ä¿¡æ¯

```json
{
  "sensor": "P075",     // â† P075 æ˜¯ä¼ æ„Ÿå™¨ PID
  "light": "P01E,P021,...",
  "switch": "P02D,..."
}
```

---

## ğŸ¯ è®¾å¤‡è¯†åˆ«é€»è¾‘

### åˆ¤æ–­æ˜¯å¦ä¸ºä¼ æ„Ÿå™¨è®¾å¤‡

```python
# æ­¥éª¤ 1: è·å–ä¼ æ„Ÿå™¨ PID åˆ—è¡¨
pids = await api.fetch_pids()
sensor_pids = set(pids["sensor"].split(","))  # {"P075"}

# æ­¥éª¤ 2: æ£€æŸ¥è®¾å¤‡ PID
for device in devices:
    if device["deviceMoldPid"] in sensor_pids:
        # âœ… æ˜¯ä¼ æ„Ÿå™¨è®¾å¤‡
```

### åˆ¤æ–­æ˜¯å¦ä¸ºæ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨

```python
# åœ¨çŠ¶æ€æ•°æ®ä¸­æ£€æŸ¥
if device.get("type") == 5:
    # âœ… æ˜¯æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨
    # å¯ä»¥è¯»å– temp, humi, bettery
```

---

## ğŸ”¢ æ•°å€¼å¤„ç†

### æ¸©åº¦
- **åŸå§‹å€¼**: 273
- **å¤„ç†**: 273 / 10 = 27.3
- **å•ä½**: Â°C
- **æ˜¾ç¤º**: 27.3Â°C

### æ¹¿åº¦
- **åŸå§‹å€¼**: 467
- **å¤„ç†**: 467 / 10 = 46.7
- **å•ä½**: %
- **æ˜¾ç¤º**: 46.7%

### ç”µé‡
- **åŸå§‹å€¼**: 99
- **å¤„ç†**: ç›´æ¥ä½¿ç”¨
- **å•ä½**: %
- **æ˜¾ç¤º**: 99%

---

## ğŸ“± åˆ›å»ºçš„ä¼ æ„Ÿå™¨å®ä½“

### å¯¹äºè®¾å¤‡ `device0E24D2E62710` (ç»„å: "75")

1. **æ¸©åº¦ä¼ æ„Ÿå™¨**
   - Entity ID: `sensor.3734_temperature`
   - åç§°: "75 Temperature"
   - å€¼: 27.3
   - å•ä½: Â°C
   - è®¾å¤‡ç±»: temperature
   - çŠ¶æ€ç±»: measurement

2. **æ¹¿åº¦ä¼ æ„Ÿå™¨**
   - Entity ID: `sensor.3734_humidity`
   - åç§°: "75 Humidity"
   - å€¼: 46.7
   - å•ä½: %
   - è®¾å¤‡ç±»: humidity
   - çŠ¶æ€ç±»: measurement

3. **ç”µé‡ä¼ æ„Ÿå™¨**
   - Entity ID: `sensor.3734_battery`
   - åç§°: "75 Battery"
   - å€¼: 99
   - å•ä½: %
   - è®¾å¤‡ç±»: battery
   - çŠ¶æ€ç±»: measurement

---

## ğŸ”„ æ•°æ®æµç¨‹

```
å¯åŠ¨é›†æˆ
    â†“
è·å–è®¾å¤‡åˆ—è¡¨ (fetch_devices)
    â†“
è·å– PID ä¿¡æ¯ (fetch_pids)
    â†“
è¿‡æ»¤ä¼ æ„Ÿå™¨è®¾å¤‡ (deviceMoldPid in sensor PIDs)
    â†“
å®šæ—¶è·å–çŠ¶æ€ (fetch_device_statuses)
    â†“
åˆå¹¶è®¾å¤‡ä¿¡æ¯å’ŒçŠ¶æ€
    â†“
è¿‡æ»¤ type=5 çš„è®¾å¤‡
    â†“
åˆ›å»ºä¼ æ„Ÿå™¨å®ä½“:
  - Temperature (temp / 10)
  - Humidity (humi / 10)
  - Battery (bettery)
    â†“
æ¯ 30 ç§’è‡ªåŠ¨æ›´æ–°
```

---

## ğŸ¨ è®¾å¤‡ä¿¡æ¯

### è®¾å¤‡å¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 75                                 â”‚
â”‚ DayBetter - WIFIQC2                â”‚
â”‚                                    â”‚
â”‚ ğŸŒ¡ï¸ Temperature: 27.3Â°C            â”‚
â”‚ ğŸ’§ Humidity: 46.7%                 â”‚
â”‚ ğŸ”‹ Battery: 99%                    â”‚
â”‚                                    â”‚
â”‚ ğŸ“¶ åœ¨çº¿                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å·²å®ç°çš„ç‰¹æ€§

### CoordinatorEntity
- âœ… è‡ªåŠ¨ä»åè°ƒå™¨è·å–æ•°æ®
- âœ… è‡ªåŠ¨æ›´æ–°ï¼ˆæ— éœ€æ‰‹åŠ¨åˆ·æ–°ï¼‰
- âœ… ç»Ÿä¸€çš„æ•°æ®æº

### è®¾å¤‡ä¿¡æ¯
- âœ… ä½¿ç”¨ deviceId ä½œä¸ºå”¯ä¸€æ ‡è¯†
- âœ… æ˜¾ç¤º deviceGroupName ä½œä¸ºè®¾å¤‡å
- âœ… æ˜¾ç¤º deviceClass ä½œä¸ºå‹å·

### ä¼ æ„Ÿå™¨å±æ€§
- âœ… æ­£ç¡®çš„è®¾å¤‡ç±»ï¼ˆtemperature/humidity/batteryï¼‰
- âœ… æ­£ç¡®çš„çŠ¶æ€ç±»ï¼ˆmeasurementï¼‰
- âœ… æ­£ç¡®çš„å•ä½ï¼ˆÂ°C/%ï¼‰
- âœ… æ•°å€¼ç¼©æ”¾ï¼ˆé™¤ä»¥ 10ï¼‰

---

## ğŸ”§ å·²æ›´æ–°çš„æ–‡ä»¶

âœ… `sensor.py`
- å®ç°æ¸©åº¦ä¼ æ„Ÿå™¨ï¼ˆtemp / 10ï¼‰
- å®ç°æ¹¿åº¦ä¼ æ„Ÿå™¨ï¼ˆhumi / 10ï¼‰
- å®ç°ç”µé‡ä¼ æ„Ÿå™¨ï¼ˆbetteryï¼‰
- ä½¿ç”¨ CoordinatorEntity
- åŸºäº type=5 è¿‡æ»¤

âœ… `daybetter_api.py`
- æ­£ç¡®è§£æ API è¿”å›æ ¼å¼
- å®ç° PID è¿‡æ»¤é€»è¾‘
- å®ç°è®¾å¤‡çŠ¶æ€åˆå¹¶

âœ… `coordinator.py`
- è·å–å¹¶ç¼“å­˜è®¾å¤‡å’Œ PID
- å®šæ—¶è·å–çŠ¶æ€
- åˆå¹¶æ•°æ®è¿”å›

---

## ğŸš€ ç°åœ¨é‡å¯æµ‹è¯•

### æ­¥éª¤ 1ï¼šé‡å¯

```
1. æŒ‰ Shift+F5 åœæ­¢
2. æŒ‰ F5 é‡æ–°å¯åŠ¨
3. é€‰æ‹©ï¼šğŸ”¥ DayBetter Services (è°ƒè¯•æ¨¡å¼)
```

### æ­¥éª¤ 2ï¼šæ·»åŠ é›†æˆ

```
1. æ‰“å¼€ http://localhost:8123
2. è®¾ç½® â†’ è®¾å¤‡ä¸æœåŠ¡ â†’ æ·»åŠ é›†æˆ
3. æœç´¢ DayBetter
4. è¾“å…¥ User Code
5. ç‚¹å‡»æäº¤
```

### æ­¥éª¤ 3ï¼šæŸ¥çœ‹ä¼ æ„Ÿå™¨

åº”è¯¥ä¼šçœ‹åˆ° 3 ä¸ªä¼ æ„Ÿå™¨ï¼š
- ğŸŒ¡ï¸ `sensor.3734_temperature` = 27.3Â°C
- ğŸ’§ `sensor.3734_humidity` = 46.7%
- ğŸ”‹ `sensor.3734_battery` = 99%

---

## âœ… é¢„æœŸæ—¥å¿—

```
INFO: DayBetter integration successful. Total devices: 7, Sensor devices: 1, PIDs: {...}
INFO: Setting up sensors for 1 sensor device(s)
INFO: Created temperature sensor for device0E24D2E62710
INFO: Created humidity sensor for device0E24D2E62710
INFO: Created battery sensor for device0E24D2E62710
```

---

## ğŸ¯ æµ‹è¯•æ¸…å•

å®ŒæˆåéªŒè¯ï¼š

- [ ] é›†æˆæ·»åŠ æˆåŠŸ
- [ ] çœ‹åˆ° 1 ä¸ªè®¾å¤‡ï¼ˆ75ï¼‰
- [ ] çœ‹åˆ° 3 ä¸ªä¼ æ„Ÿå™¨ï¼ˆæ¸©åº¦ã€æ¹¿åº¦ã€ç”µé‡ï¼‰
- [ ] æ¸©åº¦å€¼ä¸º 27.3Â°C
- [ ] æ¹¿åº¦å€¼ä¸º 46.7%
- [ ] ç”µé‡å€¼ä¸º 99%
- [ ] è®¾å¤‡æ˜¾ç¤ºä¸ºåœ¨çº¿
- [ ] æ¯ 30 ç§’è‡ªåŠ¨æ›´æ–°

---

## ğŸ‰ å®Œæˆï¼

æ‰€æœ‰åŠŸèƒ½å·²å®ç°ï¼**ç°åœ¨é‡å¯å¹¶æ·»åŠ é›†æˆï¼Œäº«å—ä½ çš„æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨å§ï¼** ğŸš€âœ¨

