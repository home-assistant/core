<html><head></head><body><dom-module id="ha-panel-shopping-list"><template><style include="ha-style">:host{height:100%;}.content{padding:24px 0 32px;max-width:600px;margin:0 auto;}paper-card{display:block;padding-bottom:16px;}.list-header{@apply --paper-font-headline;}.list-options{position:absolute;top:0;right:0;color:var(--secondary-text-color);}.list-header paper-listbox{width:150px;}.list-header paper-item{cursor:pointer;}paper-item{--paper-item-focused:{background-color:white;};}paper-checkbox{padding:11px 7px;}paper-input{width:100%;}.tip{padding:24px;text-align:center;color:var(--secondary-text-color);}</style><app-header-layout has-scrolling-region=""><app-header slot="header" fixed=""><app-toolbar><ha-menu-button narrow="[[narrow]]" show-menu="[[showMenu]]"></ha-menu-button><div main-title="">Shopping List</div><ha-start-voice-button hass="[[hass]]"></ha-start-voice-button></app-toolbar></app-header><div class="content"><paper-card><div class="card-content list-header">Shopping List<div class="list-options"><paper-menu-button horizontal-align="right" horizontal-offset="-5" vertical-offset="-5"><paper-icon-button icon="mdi:dots-vertical" slot="dropdown-trigger"></paper-icon-button><paper-listbox slot="dropdown-content"><paper-item on-tap="_clearCompleted">Clear completed</paper-item></paper-listbox></paper-menu-button></div></div><template is="dom-if" if="[[!items.length]]"><div class="card-content">You have no items on your shopping list.</div></template><template is="dom-repeat" items="[[items]]"><paper-icon-item on-tap="_enableEditting"><paper-checkbox slot="item-icon" checked="{{item.complete}}" on-tap="_itemCompleteTapped" tabindex="0"></paper-checkbox><paper-item-body><template is="dom-if" if="[[!_computeIsEditting(_editIndex, index)]]">[[item.name]]</template><template is="dom-if" if="[[_computeIsEditting(_editIndex, index)]]" restamp=""><paper-input tabindex="0" autofocus="" id="editBox" no-label-float="" value="{{_editValue}}" on-keydown="_editKeyPress"></paper-input></template></paper-item-body><template is="dom-if" if="[[_computeIsEditting(_editIndex, index)]]"><paper-icon-button icon="mdi:content-save" on-tap="_finishEditting" alt="Save item"></paper-icon-button></template></paper-icon-item></template></paper-card><div class="tip">Tap the microphone on the top right and say "Add candy to my shopping list"</div></div></app-header-layout></template></dom-module><script>Polymer({is:"ha-panel-shopping-list",properties:{hass:Object,narrow:Boolean,showMenu:Boolean,items:{type:Array,value:[]},_editIndex:{type:Number,value:-1},_editValue:{type:String,value:""}},listeners:{keydown:"_checkEsc"},attached:function(){this._fetchData=this._fetchData.bind(this),this.hass.connection.subscribeEvents(this._fetchData,"shopping_list_updated").then(function(t){this._unsubEvents=t}.bind(this)),this._fetchData()},detached:function(){this._unsubEvents&&this._unsubEvents()},_fetchData:function(){this.hass.callApi("get","shopping_list").then(function(t){this.items=t}.bind(this))},_computeIsEditting:function(t,i){return t===i},_itemCompleteTapped:function(t){t.stopPropagation();var i=t.model.item;this.hass.callApi("post","shopping_list/item/"+i.id,{complete:i.complete}).catch(function(){this._fetchData()}.bind(this))},_enableEditting:function(t){var i=t.model.item,e=this.items.indexOf(i);e!==this._editIndex&&(this._editValue=i.name,this._editIndex=e)},_cancelEditting:function(){this._editIndex=-1,this._editValue=""},_finishEditting:function(t){t.stopPropagation();var i=this._editIndex,e=this._editValue,s=this.items[i];this._editIndex=-1,this._editValue="",e!==s.name&&(this.set(["items",i,"name"],e),this.hass.callApi("post","shopping_list/item/"+s.id,{name:e}).catch(function(){this._fetchData()}.bind(this)))},_editKeyPress:function(t){13===t.keyCode&&this._finishEditting(t)},_checkEsc:function(t){27===t.keyCode&&this._cancelEditting()},_clearCompleted:function(){this.hass.callApi("POST","shopping_list/clear_completed")}});</script></body></html>